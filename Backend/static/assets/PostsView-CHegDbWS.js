import{P as C}from"./PostCard-xTKPHb_6.js";import{_ as b,u as k,c as d,a as e,h as v,i as m,v as p,s as w,t as c,g,o as i,F as h,r as f,f as F,x as S,e as _,l as x,b as M}from"./index-CAI9DG47.js";const T={name:"CreatePostModal",props:{postToEdit:{type:Object,default:null}},emits:["close","created"],setup(){return{authStore:k()}},data(){return{form:{title:"",content:"",post_type:"thought",track_name:"",artist_name:""},loading:!1,error:null}},methods:{close(){this.$emit("close")},async submitPost(){if(!this.form.title.trim()||!this.form.content.trim()){this.error="Ð—Ð°Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ Ð²ÑÐµ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ";return}this.loading=!0,this.error=null;try{const r=localStorage.getItem("access_token"),l=await(await fetch("/api/posts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(this.form)})).json();l.success?(this.$emit("created",l.post),this.resetForm()):this.error=l.error||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸ Ð¿Ð¾ÑÑ‚Ð°"}catch(r){this.error="ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐµÑ‚Ð¸. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð·Ð¶Ðµ.",console.error("Create post error:",r)}finally{this.loading=!1}},resetForm(){this.form={title:"",content:"",post_type:"thought",track_name:"",artist_name:""}}}},V={class:"create-post-modal"},A={class:"modal-header"},L={class:"form-group"},U={class:"form-group"},N={class:"form-group"},q={class:"char-counter"},B={class:"form-group"},I={class:"track-attachment"},Q={class:"form-actions"},j=["disabled"],O={key:0,class:"error-message"};function D(r,t,l,u,s,n){return i(),d("div",V,[e("div",{class:"modal-overlay",onClick:t[9]||(t[9]=(...a)=>n.close&&n.close(...a))},[e("div",{class:"modal-content",onClick:t[8]||(t[8]=v(()=>{},["stop"]))},[e("div",A,[t[10]||(t[10]=e("h2",null,"Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿Ð¾ÑÑ‚",-1)),e("button",{class:"close-btn",onClick:t[0]||(t[0]=(...a)=>n.close&&n.close(...a))},"âœ•")]),e("form",{onSubmit:t[7]||(t[7]=v((...a)=>n.submitPost&&n.submitPost(...a),["prevent"])),class:"create-post-form"},[e("div",L,[t[11]||(t[11]=e("label",{for:"postTitle"},"Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº *",-1)),m(e("input",{id:"postTitle","onUpdate:modelValue":t[1]||(t[1]=a=>s.form.title=a),placeholder:"Ðž Ñ‡ÐµÐ¼ Ñ…Ð¾Ñ‡ÐµÑˆÑŒ Ñ€Ð°ÑÑÐºÐ°Ð·Ð°Ñ‚ÑŒ?",required:""},null,512),[[p,s.form.title]])]),e("div",U,[t[13]||(t[13]=e("label",{for:"postType"},"Ð¢Ð¸Ð¿ Ð¿Ð¾ÑÑ‚Ð°",-1)),m(e("select",{id:"postType","onUpdate:modelValue":t[2]||(t[2]=a=>s.form.post_type=a)},[...t[12]||(t[12]=[e("option",{value:"thought"},"ÐœÑ‹ÑÐ»Ð¸",-1),e("option",{value:"review"},"Ð ÐµÑ†ÐµÐ½Ð·Ð¸Ñ",-1),e("option",{value:"news"},"ÐÐ¾Ð²Ð¾ÑÑ‚Ð¸",-1),e("option",{value:"quote"},"Ð¦Ð¸Ñ‚Ð°Ñ‚Ð°",-1)])],512),[[w,s.form.post_type]])]),e("div",N,[t[14]||(t[14]=e("label",{for:"postContent"},"Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð°Ð½Ð¸Ðµ *",-1)),m(e("textarea",{id:"postContent","onUpdate:modelValue":t[3]||(t[3]=a=>s.form.content=a),placeholder:"ÐŸÐ¾Ð´ÐµÐ»Ð¸ÑÑŒ ÑÐ²Ð¾Ð¸Ð¼Ð¸ Ð¼Ñ‹ÑÐ»ÑÐ¼Ð¸...",rows:"6",required:""},null,512),[[p,s.form.content]]),e("div",q,c(s.form.content.length)+"/5000",1)]),e("div",B,[t[15]||(t[15]=e("label",null,"ÐŸÑ€Ð¸ÐºÑ€ÐµÐ¿Ð¸Ñ‚ÑŒ Ñ‚Ñ€ÐµÐº",-1)),e("div",I,[m(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>s.form.track_name=a),placeholder:"ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ñ‚Ñ€ÐµÐºÐ°",class:"track-input"},null,512),[[p,s.form.track_name]]),m(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>s.form.artist_name=a),placeholder:"Ð˜ÑÐ¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒ",class:"track-input"},null,512),[[p,s.form.artist_name]])])]),e("div",Q,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[6]||(t[6]=(...a)=>n.close&&n.close(...a))},"ÐžÑ‚Ð¼ÐµÐ½Ð°"),e("button",{type:"submit",class:"btn btn-primary",disabled:s.loading},c(s.loading?"ÐŸÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸Ñ...":"ÐžÐ¿ÑƒÐ±Ð»Ð¸ÐºÐ¾Ð²Ð°Ñ‚ÑŒ"),9,j)]),s.error?(i(),d("div",O,c(s.error),1)):g("",!0)],32)])])])}const J=b(T,[["render",D],["__scopeId","data-v-51f8209f"]]),z={name:"PostsView",components:{PostCard:C,CreatePostModal:J},data(){return{searchQuery:"",activeFilter:"all",showCreateModal:!1,currentPage:1,postsPerPage:10,posts:[],filters:[{id:"all",label:"Ð’ÑÐµ"},{id:"reviews",label:"Ð ÐµÑ†ÐµÐ½Ð·Ð¸Ð¸"},{id:"thoughts",label:"ÐœÑ‹ÑÐ»Ð¸"},{id:"quotes",label:"Ð¦Ð¸Ñ‚Ð°Ñ‚Ñ‹"},{id:"news",label:"ÐÐ¾Ð²Ð¾ÑÑ‚Ð¸"}],trendingTags:[{name:"Ð½Ð¾Ð²Ð¸Ð½ÐºÐ°"},{name:"Ñ…Ð¸Ð¿Ñ…Ð¾Ð¿"},{name:"Ñ€Ð¾Ðº"},{name:"Ð¾Ð±Ð·Ð¾Ñ€"},{name:"ÐºÐ¾Ð½Ñ†ÐµÑ€Ñ‚"}],popularAuthors:[{id:1,name:"ÐÐ»ÐµÐºÑÐµÐ¹ Ð Ð¾ÐºÐµÑ€",avatar:"https://i.pravatar.cc/150?img=12",posts:45,isFollowing:!1},{id:2,name:"ÐœÐ°Ñ€Ð¸Ñ ÐœÐµÐ»Ð¾Ð¼Ð°Ð½Ð°",avatar:"https://i.pravatar.cc/150?img=5",posts:32,isFollowing:!0},{id:3,name:"DJ ÐŸÐµÑ‚Ñ€Ð¾Ð²Ð¸Ñ‡",avatar:"https://i.pravatar.cc/150?img=8",posts:28,isFollowing:!1}]}},computed:{currentUserAvatar(){return JSON.parse(localStorage.getItem("user")||"{}").avatar||"https://i.pravatar.cc/150?img=1"},filteredPosts(){let r=this.posts;if(this.searchQuery){const u=this.searchQuery.toLowerCase();r=r.filter(s=>s.title.toLowerCase().includes(u)||s.content.toLowerCase().includes(u)||s.author&&s.author.name&&s.author.name.toLowerCase().includes(u))}this.activeFilter!=="all"&&(r=r.filter(u=>u.type===this.activeFilter));const t=(this.currentPage-1)*this.postsPerPage,l=t+this.postsPerPage;return r.slice(t,l)},totalPages(){return Math.ceil(this.posts.length/this.postsPerPage)}},async mounted(){await this.loadPosts()},methods:{async loadPosts(){try{const t=await(await fetch("/api/posts")).json();t.success&&(this.posts=t.posts.map(l=>{const u=l.author||{};return{id:l.id,title:l.title,content:l.content,created_at:l.created_at,likes_count:l.likes_count,comments_count:l.comments_count,author:{name:u.username||u.name||"ÐÐ²Ñ‚Ð¾Ñ€",isVerified:u.is_verified||!1},track_name:l.track_name,artist_name:l.artist_name,album_art_url:l.album_art_url,media_url:l.media_url,post_type:l.post_type,tags:l.tags||[],type:l.post_type||"thought"}}))}catch(r){console.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð¿Ð¾ÑÑ‚Ð¾Ð²:",r)}},handleSearch(){this.currentPage=1},applyFilter(r){this.activeFilter=r,this.currentPage=1},followAuthor(r){const t=this.popularAuthors.find(l=>l.id===r);t&&(t.isFollowing=!t.isFollowing)},handleLike(r){console.log("Ð›Ð°Ð¹Ðº Ð¿Ð¾ÑÑ‚Ð°:",r)},handleComment(r){this.$router.push(`/post/${r}`)},handlePostCreated(r){this.posts.unshift(r),this.showCreateModal=!1},prevPage(){this.currentPage>1&&(this.currentPage--,window.scrollTo(0,0))},nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,window.scrollTo(0,0))}}},E={class:"posts-view"},G={class:"posts-header"},H={class:"filters-bar"},K={class:"search-box"},R={class:"filter-buttons"},W=["onClick"],X={class:"posts-content"},Y={class:"sidebar"},Z={class:"sidebar-section"},$={class:"trending-tags"},tt={class:"sidebar-section"},et={class:"popular-authors"},st=["src"],ot={class:"author-info"},rt=["onClick"],nt={class:"posts-feed"},lt={class:"create-post-btn-container"},at={class:"posts-list"},it={key:0,class:"no-posts"},dt={key:1,class:"pagination"},ut=["disabled"],ct={class:"page-info"},mt=["disabled"];function pt(r,t,l,u,s,n){const a=_("PostCard"),P=_("CreatePostModal");return i(),d("div",E,[e("div",G,[t[7]||(t[7]=e("h1",null,"Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÑÑ‚Ð²Ð¾ Ð¼ÑƒÐ·Ñ‹ÐºÐ°Ð½Ñ‚Ð¾Ð²",-1)),t[8]||(t[8]=e("p",null,"Ð§Ð¸Ñ‚Ð°Ð¹, Ð¾Ð±Ñ‰Ð°Ð¹ÑÑ Ð¸ Ð´ÐµÐ»Ð¸ÑÑŒ Ð¼ÑƒÐ·Ñ‹ÐºÐ¾Ð¹",-1)),e("div",H,[e("div",K,[m(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=o=>s.searchQuery=o),placeholder:"ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ÑÑ‚Ð¾Ð², Ñ‚Ñ€ÐµÐºÐ¾Ð², Ð¸ÑÐ¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÐµÐ¹...",onInput:t[1]||(t[1]=(...o)=>n.handleSearch&&n.handleSearch(...o))},null,544),[[p,s.searchQuery]]),t[6]||(t[6]=e("span",{class:"search-icon"},"ðŸ”",-1))]),e("div",R,[(i(!0),d(h,null,f(s.filters,o=>(i(),d("button",{key:o.id,class:x(["filter-btn",{active:s.activeFilter===o.id}]),onClick:y=>n.applyFilter(o.id)},c(o.label),11,W))),128))])])]),e("div",X,[e("aside",Y,[e("div",Z,[t[9]||(t[9]=e("h3",null,"ÐŸÐ¾Ð¿ÑƒÐ»ÑÑ€Ð½Ñ‹Ðµ Ñ‚ÐµÐ³Ð¸",-1)),e("div",$,[(i(!0),d(h,null,f(s.trendingTags,o=>(i(),d("span",{class:"trend-tag",key:o.name}," #"+c(o.name),1))),128))])]),e("div",tt,[t[10]||(t[10]=e("h3",null,"Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÐ¼Ñ‹Ðµ Ð°Ð²Ñ‚Ð¾Ñ€Ñ‹",-1)),e("div",et,[(i(!0),d(h,null,f(s.popularAuthors,o=>(i(),d("div",{class:"author-card",key:o.id},[e("img",{src:o.avatar,alt:"Avatar"},null,8,st),e("div",ot,[e("strong",null,c(o.name),1),e("span",null,c(o.posts)+" Ð¿Ð¾ÑÑ‚Ð¾Ð²",1)]),e("button",{class:"follow-btn",onClick:y=>n.followAuthor(o.id)},c(o.isFollowing?"âœ“ ÐŸÐ¾Ð´Ð¿Ð¸ÑÐ°Ð½":"ÐŸÐ¾Ð´Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ"),9,rt)]))),128))])])]),e("main",nt,[e("div",lt,[e("button",{class:"create-post-btn",onClick:t[2]||(t[2]=o=>s.showCreateModal=!0)},[...t[11]||(t[11]=[e("span",{class:"plus-icon"},"+",-1),F(" Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿Ð¾ÑÑ‚ ",-1)])])]),e("div",at,[(i(!0),d(h,null,f(n.filteredPosts,o=>(i(),d("div",{key:o.id,class:"post-item"},[M(a,{post:o,onLike:n.handleLike,onComment:n.handleComment},null,8,["post","onLike","onComment"])]))),128))]),n.filteredPosts.length===0?(i(),d("div",it,[...t[12]||(t[12]=[e("p",null,"ÐŸÐ¾ÑÑ‚Ð¾Ð² Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚. Ð‘ÑƒÐ´ÑŒÑ‚Ðµ Ð¿ÐµÑ€Ð²Ñ‹Ð¼!",-1)])])):g("",!0),n.filteredPosts.length>0?(i(),d("div",dt,[e("button",{class:"pagination-btn",disabled:s.currentPage===1,onClick:t[3]||(t[3]=(...o)=>n.prevPage&&n.prevPage(...o))}," â† ÐÐ°Ð·Ð°Ð´ ",8,ut),e("span",ct," Ð¡Ñ‚Ñ€Ð°Ð½Ð¸Ñ†Ð° "+c(s.currentPage)+" Ð¸Ð· "+c(n.totalPages),1),e("button",{class:"pagination-btn",disabled:s.currentPage===n.totalPages,onClick:t[4]||(t[4]=(...o)=>n.nextPage&&n.nextPage(...o))}," Ð”Ð°Ð»ÐµÐµ â†’ ",8,mt)])):g("",!0)])]),s.showCreateModal?(i(),S(P,{key:0,onClose:t[5]||(t[5]=o=>s.showCreateModal=!1),onCreated:n.handlePostCreated},null,8,["onCreated"])):g("",!0)])}const gt=b(z,[["render",pt],["__scopeId","data-v-351dcc0a"]]);export{gt as default};
