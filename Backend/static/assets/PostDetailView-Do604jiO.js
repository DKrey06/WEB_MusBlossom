import{_ as k,c as l,a as t,b as h,w as p,t as a,g as u,i as y,v as w,y as b,h as C,F as _,r as v,u as S,d as P,o as r,f as g,x as T}from"./index-CkOo5300.js";const x={name:"PostDetailView",props:["id"],setup(){return{authStore:S()}},data(){return{post:null,comments:[],similarPosts:[],newComment:"",loading:!0}},computed:{currentUserAvatar(){return JSON.parse(localStorage.getItem("user")||"{}").avatar||"https://i.pravatar.cc/150?img=1"}},async mounted(){await this.loadPost()},methods:{async loadPost(){try{const s=await(await fetch(`/api/posts/${this.$route.params.id}`)).json();s.success&&(this.post=s.post,this.comments=s.comments||[],await this.loadSimilarPosts())}catch(e){console.error("Error loading post:",e)}finally{this.loading=!1}},async loadSimilarPosts(){try{const s=await(await fetch(`/api/posts?type=${this.post.post_type}`)).json();s.success&&(this.similarPosts=s.posts.filter(c=>c.id!==this.post.id).slice(0,3))}catch(e){console.error("Error loading similar posts:",e)}},formatDate(e){return new Date(e).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})},formatTime(e){const s=new Date(e),m=new Date-s,n=Math.floor(m/6e4),i=Math.floor(m/36e5),d=Math.floor(m/864e5);return n<60?`${n} –º–∏–Ω –Ω–∞–∑–∞–¥`:i<24?`${i} —á –Ω–∞–∑–∞–¥`:d<7?`${d} –¥ –Ω–∞–∑–∞–¥`:s.toLocaleDateString("ru-RU")},getPostTypeLabel(e){return{thought:"–ú—ã—Å–ª–∏",review:"–†–µ—Ü–µ–Ω–∑–∏—è",news:"–ù–æ–≤–æ—Å—Ç–∏",quote:"–¶–∏—Ç–∞—Ç–∞"}[e]||"–ü–æ—Å—Ç"},formatContent(e){return e.replace(/\n/g,"<br>")},async toggleLike(){if(!this.authStore.isAuthenticated){this.$router.push("/login");return}try{const e=localStorage.getItem("access_token"),c=await(await fetch(`/api/posts/${this.post.id}/like`,{method:"POST",headers:{Authorization:`Bearer ${e}`}})).json();c.success&&(this.post.is_liked=!this.post.is_liked,this.post.likes_count=c.likes_count)}catch(e){console.error("Error toggling like:",e)}},async addComment(){if(this.newComment.trim()){if(!this.authStore.isAuthenticated){this.$router.push("/login");return}try{const e=localStorage.getItem("access_token"),c=await(await fetch(`/api/posts/${this.post.id}/comments`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({content:this.newComment})})).json();c.success&&(this.comments.unshift(c.comment),this.post.comments_count++,this.newComment="")}catch(e){console.error("Error adding comment:",e)}}},focusComment(){document.querySelector(".comment-input-container textarea")?.focus()},sharePost(){navigator.share?navigator.share({title:this.post.title,text:this.post.content.substring(0,100),url:window.location.href}):(navigator.clipboard.writeText(window.location.href),alert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!"))},likeComment(e){console.log("Like comment:",e)},replyToComment(e){this.newComment=`@${e.author.username} `,this.focusComment()},toggleSave(){console.log("Toggle save")}}},D={class:"post-detail-view"},L={key:0,class:"loading"},A={key:1,class:"post-container"},M={class:"post-card detailed"},V={class:"post-header"},B=["src"],N={class:"post-meta"},j={class:"author-info"},E={class:"author-name"},U={key:0,class:"author-badge"},I={class:"post-time"},O={class:"post-content"},H={class:"post-title"},q={class:"post-type"},z=["innerHTML"],F={key:0,class:"track-info"},J={class:"track-details"},K={key:0},R={class:"post-stats"},G={class:"stat"},Q={class:"stat-value"},W={class:"stat"},X={class:"stat-value"},Y={class:"stat"},Z={class:"stat-value"},$={class:"post-actions"},tt={class:"comments-section"},st={class:"add-comment"},ot=["src"],et={class:"comment-input-container"},nt={class:"comments-list"},it=["src"],at={class:"comment-content"},rt={class:"comment-header"},lt={class:"comment-author"},ct={class:"comment-time"},dt={class:"comment-text"},mt={class:"comment-actions"},ut=["onClick"],pt=["onClick"],ht={key:0,class:"similar-posts"},_t={class:"similar-posts-grid"},vt={class:"similar-post-meta"},gt={key:2,class:"not-found"};function ft(e,s,c,m,n,i){const d=P("router-link");return r(),l("div",D,[n.loading?(r(),l("div",L,[...s[7]||(s[7]=[t("div",{class:"spinner"},null,-1)])])):n.post?(r(),l("div",A,[h(d,{to:"/posts",class:"back-link"},{default:p(()=>[...s[8]||(s[8]=[g("‚Üê –ù–∞–∑–∞–¥ –∫ –ø–æ—Å—Ç–∞–º",-1)])]),_:1}),t("div",M,[t("div",V,[t("img",{src:n.post.author.avatar,class:"author-avatar",alt:"Avatar"},null,8,B),t("div",N,[t("div",j,[t("span",E,a(n.post.author.name),1),n.post.author.isVerified?(r(),l("span",U,"‚úì")):u("",!0)]),t("span",I,a(i.formatDate(n.post.created_at)),1)])]),t("div",O,[t("h1",H,a(n.post.title),1),t("div",q,a(i.getPostTypeLabel(n.post.post_type)),1),t("div",{class:"post-text",innerHTML:i.formatContent(n.post.content)},null,8,z),n.post.track_name?(r(),l("div",F,[s[9]||(s[9]=t("div",{class:"track-icon"},"üéµ",-1)),t("div",J,[t("strong",null,a(n.post.track_name),1),n.post.artist_name?(r(),l("span",K,"by "+a(n.post.artist_name),1)):u("",!0)])])):u("",!0)]),t("div",R,[t("div",G,[s[10]||(s[10]=t("span",{class:"stat-icon"},"‚ù§Ô∏è",-1)),t("span",Q,a(n.post.likes_count),1),s[11]||(s[11]=t("span",{class:"stat-label"},"–ª–∞–π–∫–æ–≤",-1))]),t("div",W,[s[12]||(s[12]=t("span",{class:"stat-icon"},"üí¨",-1)),t("span",X,a(n.post.comments_count),1),s[13]||(s[13]=t("span",{class:"stat-label"},"–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤",-1))]),t("div",Y,[s[14]||(s[14]=t("span",{class:"stat-icon"},"üëÅÔ∏è",-1)),t("span",Z,a(n.post.views_count||0),1),s[15]||(s[15]=t("span",{class:"stat-label"},"–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤",-1))])]),t("div",$,[t("button",{class:"action-btn like-btn",onClick:s[0]||(s[0]=(...o)=>i.toggleLike&&i.toggleLike(...o))},a(n.post.is_liked?"‚ù§Ô∏è":"ü§ç")+" "+a(n.post.likes_count),1),t("button",{class:"action-btn comment-btn",onClick:s[1]||(s[1]=(...o)=>i.focusComment&&i.focusComment(...o))},"üí¨ –ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å"),t("button",{class:"action-btn share-btn",onClick:s[2]||(s[2]=(...o)=>i.sharePost&&i.sharePost(...o))},"‚Ü™Ô∏è –ü–æ–¥–µ–ª–∏—Ç—å—Å—è"),t("button",{class:"action-btn save-btn",onClick:s[3]||(s[3]=(...o)=>i.toggleSave&&i.toggleSave(...o))},a(n.post.is_saved?"‚òÖ":"‚òÜ"),1)])]),t("div",tt,[t("h2",null,"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ("+a(n.comments.length)+")",1),t("div",st,[t("img",{src:i.currentUserAvatar,class:"comment-user-avatar",alt:"Avatar"},null,8,ot),t("div",et,[y(t("textarea",{"onUpdate:modelValue":s[4]||(s[4]=o=>n.newComment=o),placeholder:"–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π...",onKeydown:s[5]||(s[5]=b(C((...o)=>i.addComment&&i.addComment(...o),["exact","prevent"]),["enter"])),rows:"3"},null,544),[[w,n.newComment]]),t("button",{onClick:s[6]||(s[6]=(...o)=>i.addComment&&i.addComment(...o)),class:"submit-comment-btn"},"–û—Ç–ø—Ä–∞–≤–∏—Ç—å")])]),t("div",nt,[(r(!0),l(_,null,v(n.comments,o=>(r(),l("div",{key:o.id,class:"comment"},[t("img",{src:o.author.avatar,class:"comment-avatar",alt:"Avatar"},null,8,it),t("div",at,[t("div",rt,[t("span",lt,a(o.author.name),1),t("span",ct,a(i.formatTime(o.created_at)),1)]),t("p",dt,a(o.content),1),t("div",mt,[t("button",{class:"comment-action-btn",onClick:f=>i.likeComment(o.id)}," ‚ù§Ô∏è "+a(o.likes_count||0),9,ut),t("button",{class:"comment-action-btn",onClick:f=>i.replyToComment(o)}," –û—Ç–≤–µ—Ç–∏—Ç—å ",8,pt)])])]))),128))])]),n.similarPosts.length?(r(),l("div",ht,[s[16]||(s[16]=t("h2",null,"–ü–æ—Ö–æ–∂–∏–µ –ø–æ—Å—Ç—ã",-1)),t("div",_t,[(r(!0),l(_,null,v(n.similarPosts,o=>(r(),T(d,{key:o.id,to:`/posts/${o.id}`,class:"similar-post"},{default:p(()=>[t("h3",null,a(o.title),1),t("p",null,a(o.content.substring(0,100))+"...",1),t("div",vt,[t("span",null,"üë§ "+a(o.author.username),1),t("span",null,"‚ù§Ô∏è "+a(o.likes_count),1)])]),_:2},1032,["to"]))),128))])])):u("",!0)])):(r(),l("div",gt,[s[18]||(s[18]=t("h2",null,"–ü–æ—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω",-1)),s[19]||(s[19]=t("p",null,"–í–æ–∑–º–æ–∂–Ω–æ, –æ–Ω –±—ã–ª —É–¥–∞–ª–µ–Ω –∏–ª–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω.",-1)),h(d,{to:"/posts",class:"btn btn-primary"},{default:p(()=>[...s[17]||(s[17]=[g(" –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø–æ—Å—Ç–∞–º ",-1)])]),_:1})]))])}const yt=k(x,[["render",ft],["__scopeId","data-v-84e8c477"]]);export{yt as default};
