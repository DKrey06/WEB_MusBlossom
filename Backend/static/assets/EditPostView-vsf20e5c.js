import{_ as k,c as i,a as e,g as m,h as p,v as g,F as h,r as v,f as d,t as c,x as f,o as r,y as b,e as y}from"./index-V0CKEUNY.js";const T={name:"EditPostView",data(){return{post:{title:"",content:"",post_type:"thought",track_name:"",artist_name:"",track_cover:"",tags:[]},saving:!1,postTypes:[{value:"thought",label:"Мысли"},{value:"review",label:"Рецензия"},{value:"news",label:"Новости"},{value:"quote",label:"Цитата"}],trackSearch:"",trackResults:[],tagInput:"",tagSuggestions:[],allTags:["Рок","Поп","Хип-хоп","Джаз","Классика","Электроника","Инди","Метал","Фолк","R&B","Соул","Регги"]}},async mounted(){await this.loadPost()},watch:{tagInput(o){o.trim()?this.tagSuggestions=this.allTags.filter(t=>t.toLowerCase().includes(o.toLowerCase())&&!this.post.tags.includes(t)):this.tagSuggestions=[]}},methods:{async loadPost(){try{const o=this.$route.params.id,l=await(await fetch(`http://localhost:5000/api/posts/${o}`)).json();l.success&&(this.post={title:l.post.title,content:l.post.content,post_type:l.post.post_type,track_name:l.post.track_name,artist_name:l.post.artist_name,track_cover:l.post.album_art_url,tags:l.post.tags||[]})}catch(o){console.error("Error loading post:",o)}},searchTracks(){if(this.trackSearch.length<2){this.trackResults=[];return}this.trackResults=[{id:1,title:"Blinding Lights",artist:"The Weeknd",cover:"https://i.scdn.co/image/ab67616d00001e02/86a0f12c8d1c65b6e6c8b1a0f2c5e8b1d5b3a8f2"},{id:2,title:"Levitating",artist:"Dua Lipa",cover:"https://i.scdn.co/image/ab67616d00001e02/f2b8b5b5f5b5f5b5f5b5f5b5f5b5f5b5f5b5f5b5"}]},selectTrack(o){this.post.track_name=o.title,this.post.artist_name=o.artist,this.post.track_cover=o.cover,this.trackSearch="",this.trackResults=[]},removeTrack(){this.post.track_name="",this.post.artist_name="",this.post.track_cover=""},addTag(){const o=this.tagInput.trim();o&&!this.post.tags.includes(o)&&(this.post.tags.push(o),this.tagInput="",this.tagSuggestions=[])},addTagFromSuggestion(o){this.post.tags.includes(o)||(this.post.tags.push(o),this.tagInput="",this.tagSuggestions=[])},removeTag(o){this.post.tags=this.post.tags.filter(t=>t!==o)},async updatePost(){this.saving=!0;try{const o=localStorage.getItem("access_token"),t=this.$route.params.id,_=await(await fetch(`http://localhost:5000/api/posts/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(this.post)})).json();_.success?this.$router.push(`/posts/${t}`):alert("Ошибка: "+_.error)}catch(o){console.error("Error updating post:",o),alert("Ошибка сохранения поста")}finally{this.saving=!1}},cancelEdit(){confirm("Отменить редактирование? Все несохраненные изменения будут потеряны.")&&this.$router.go(-1)}}},w={class:"edit-post-view"},S={class:"edit-container"},C={class:"form-group"},I={class:"form-group"},x={class:"form-group"},V={class:"type-options"},E=["value"],P={key:0,class:"form-group"},R={class:"track-search"},B={key:0,class:"track-results"},L=["onClick"],U=["src","alt"],F={class:"track-info"},N={class:"track-title"},j={class:"track-artist"},q={key:0,class:"selected-track"},D={class:"track-display"},M=["src"],K={class:"track-details"},z={key:0},A={class:"form-group"},J={class:"tags-input"},O={class:"selected-tags"},W=["onClick"],G={key:0,class:"tag-suggestions"},H=["onClick"],Q={class:"form-actions"},X=["disabled"];function Y(o,t,l,_,a,n){return r(),i("div",w,[t[15]||(t[15]=e("div",{class:"edit-header"},[e("h1",null,"Редактировать пост")],-1)),e("div",S,[e("form",{onSubmit:t[9]||(t[9]=m((...s)=>n.updatePost&&n.updatePost(...s),["prevent"])),class:"post-form"},[e("div",C,[t[10]||(t[10]=e("label",{for:"post-title"},"Заголовок",-1)),p(e("input",{type:"text",id:"post-title","onUpdate:modelValue":t[0]||(t[0]=s=>a.post.title=s),placeholder:"Введите заголовок...",required:""},null,512),[[g,a.post.title]])]),e("div",I,[t[11]||(t[11]=e("label",{for:"post-content"},"Содержание",-1)),p(e("textarea",{id:"post-content","onUpdate:modelValue":t[1]||(t[1]=s=>a.post.content=s),placeholder:"Напишите ваш пост...",rows:"10",required:""},null,512),[[g,a.post.content]])]),e("div",x,[t[12]||(t[12]=e("label",null,"Тип поста",-1)),e("div",V,[(r(!0),i(h,null,v(a.postTypes,s=>(r(),i("label",{key:s.value,class:"type-option"},[p(e("input",{type:"radio","onUpdate:modelValue":t[2]||(t[2]=u=>a.post.post_type=u),value:s.value},null,8,E),[[b,a.post.post_type]]),e("span",null,c(s.label),1)]))),128))])]),a.post.post_type==="review"?(r(),i("div",P,[t[13]||(t[13]=e("label",null,"Музыкальный трек",-1)),e("div",R,[p(e("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=s=>a.trackSearch=s),placeholder:"Поиск трека...",onInput:t[4]||(t[4]=(...s)=>n.searchTracks&&n.searchTracks(...s))},null,544),[[g,a.trackSearch]]),a.trackResults.length?(r(),i("div",B,[(r(!0),i(h,null,v(a.trackResults,s=>(r(),i("div",{key:s.id,class:"track-result",onClick:u=>n.selectTrack(s)},[e("img",{src:s.cover,alt:s.title,class:"track-cover"},null,8,U),e("div",F,[e("span",N,c(s.title),1),e("span",j,c(s.artist),1)])],8,L))),128))])):d("",!0)]),a.post.track_name?(r(),i("div",q,[e("div",D,[e("img",{src:a.post.track_cover||"https://via.placeholder.com/50",alt:"Cover",class:"track-cover"},null,8,M),e("div",K,[e("strong",null,c(a.post.track_name),1),a.post.artist_name?(r(),i("span",z,c(a.post.artist_name),1)):d("",!0)]),e("button",{type:"button",class:"remove-track",onClick:t[5]||(t[5]=(...s)=>n.removeTrack&&n.removeTrack(...s))},"×")])])):d("",!0)])):d("",!0),e("div",A,[t[14]||(t[14]=e("label",null,"Теги",-1)),e("div",J,[e("div",O,[(r(!0),i(h,null,v(a.post.tags,s=>(r(),i("span",{key:s,class:"tag"},[y(c(s)+" ",1),e("button",{type:"button",onClick:u=>n.removeTag(s),class:"remove-tag"},"×",8,W)]))),128))]),p(e("input",{type:"text","onUpdate:modelValue":t[6]||(t[6]=s=>a.tagInput=s),placeholder:"Добавьте теги...",onKeydown:t[7]||(t[7]=f(m((...s)=>n.addTag&&n.addTag(...s),["prevent"]),["enter"]))},null,544),[[g,a.tagInput]]),a.tagSuggestions.length?(r(),i("div",G,[(r(!0),i(h,null,v(a.tagSuggestions,s=>(r(),i("div",{key:s,class:"suggestion",onClick:u=>n.addTagFromSuggestion(s)},c(s),9,H))),128))])):d("",!0)])]),e("div",Q,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[8]||(t[8]=(...s)=>n.cancelEdit&&n.cancelEdit(...s))},"Отмена"),e("button",{type:"submit",class:"btn btn-primary",disabled:a.saving},c(a.saving?"Сохранение...":"Сохранить изменения"),9,X)])],32)])])}const $=k(T,[["render",Y],["__scopeId","data-v-8d5a4943"]]);export{$ as default};
