import{_ as h,c as l,a as e,F as m,r as w,h as f,i as p,v as c,t as a,g as u,u as v,o as i,l as g}from"./index-CkOo5300.js";const y={name:"SettingsView",setup(){return{authStore:v()}},data(){return{activeTab:"profile",tabs:[{id:"profile",label:"Профиль"},{id:"security",label:"Безопасность"},{id:"account",label:"Аккаунт"}],profileForm:{username:"",bio:"",location:"",genres:[]},availableGenres:["Rock","Pop","Hip-Hop","Jazz","Classical","Electronic","Indie","Metal","Folk","R&B","Soul","Reggae","Country","Blues","Funk","Alternative","Punk","Disco","House","Techno","Trance","Dubstep","Reggaeton","Salsa","K-Pop","J-Pop","Lo-Fi","Ambient","Instrumental"],profileLoading:!1,profileError:null,profileSuccess:!1,passwordForm:{currentPassword:"",newPassword:"",confirmPassword:""},passwordLoading:!1,passwordError:null,passwordSuccess:!1,showDeleteModal:!1,deleteForm:{password:""},deleteLoading:!1,deleteError:null}},mounted(){this.loadUserData()},methods:{loadUserData(){const t=JSON.parse(localStorage.getItem("user")||"{}");this.profileForm={username:t.username||"",bio:t.bio||"",location:t.location||"",genres:Array.isArray(t.genres)?t.genres:t.genres?[t.genres]:[]}},toggleGenre(t){const s=this.profileForm.genres.indexOf(t);s===-1?this.profileForm.genres.length<5&&this.profileForm.genres.push(t):this.profileForm.genres.splice(s,1)},async updateProfile(){if(this.profileForm.genres.length>5){this.profileError="Выберите не более 5 жанров";return}this.profileLoading=!0,this.profileError=null,this.profileSuccess=!1;try{const t=localStorage.getItem("access_token"),n=await(await fetch("/api/profile/update",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(this.profileForm)})).json();n.success?(this.profileSuccess=!0,localStorage.setItem("user",JSON.stringify(n.user)),this.authStore.user=n.user,setTimeout(()=>{this.profileSuccess=!1},3e3)):this.profileError=n.error||"Ошибка при обновлении профиля"}catch(t){this.profileError="Ошибка сети. Попробуйте позже.",console.error("Update profile error:",t)}finally{this.profileLoading=!1}},async changePassword(){if(this.passwordForm.newPassword!==this.passwordForm.confirmPassword){this.passwordError="Новые пароли не совпадают";return}if(this.passwordForm.newPassword.length<6){this.passwordError="Новый пароль должен содержать минимум 6 символов";return}this.passwordLoading=!0,this.passwordError=null,this.passwordSuccess=!1;try{const t=localStorage.getItem("access_token"),n=await(await fetch("/api/auth/change-password",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({current_password:this.passwordForm.currentPassword,new_password:this.passwordForm.newPassword})})).json();n.success?(this.passwordSuccess=!0,this.passwordForm={currentPassword:"",newPassword:"",confirmPassword:""},setTimeout(()=>{this.passwordSuccess=!1},3e3)):this.passwordError=n.error||"Ошибка при смене пароля"}catch(t){this.passwordError="Ошибка сети. Попробуйте позже.",console.error("Change password error:",t)}finally{this.passwordLoading=!1}},logout(){this.authStore.logout()},async deleteAccount(){if(!this.deleteForm.password){this.deleteError="Введите пароль";return}this.deleteLoading=!0,this.deleteError=null;try{const t=localStorage.getItem("access_token"),n=await(await fetch("/api/auth/delete-account",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({password:this.deleteForm.password})})).json();n.success?(this.authStore.logout(),this.$router.push("/")):this.deleteError=n.error||"Ошибка при удалении аккаунта"}catch(t){this.deleteError="Ошибка сети. Попробуйте позже.",console.error("Delete account error:",t)}finally{this.deleteLoading=!1}}}},F={class:"settings-view"},P={class:"settings-container"},S={class:"settings-tabs"},k=["onClick"],E={class:"settings-content"},C={key:0,class:"tab-content"},L={class:"form-group"},T={class:"form-group"},D={class:"form-group"},_={class:"form-group"},A={class:"genres-selector"},U={class:"genres-grid"},V=["onClick","disabled"],M={class:"selected-info"},x={class:"form-actions"},B=["disabled"],I={key:0,class:"alert alert-error"},J={key:1,class:"alert alert-success"},N={key:1,class:"tab-content"},O={class:"form-group"},j={class:"form-group"},z={class:"form-group"},q={class:"form-actions"},G=["disabled"],R={key:0,class:"alert alert-error"},H={key:1,class:"alert alert-success"},K={key:2,class:"tab-content"},Q={class:"account-actions"},W={class:"account-action"},X={class:"account-action"},Y={class:"modal-header"},Z={class:"modal-body"},$={class:"form-group"},ss={class:"modal-actions"},es=["disabled"],os={key:0,class:"alert alert-error"};function rs(t,s,n,ts,o,d){return i(),l("div",F,[s[36]||(s[36]=e("div",{class:"settings-header"},[e("h1",null,"Настройки"),e("p",null,"Управление вашим аккаунтом MusBlossom")],-1)),e("div",P,[e("div",S,[(i(!0),l(m,null,w(o.tabs,r=>(i(),l("button",{key:r.id,class:g({active:o.activeTab===r.id}),onClick:b=>o.activeTab=r.id},a(r.label),11,k))),128))]),e("div",E,[o.activeTab==="profile"?(i(),l("div",C,[s[22]||(s[22]=e("h2",null,"Настройки профиля",-1)),e("form",{onSubmit:s[3]||(s[3]=f((...r)=>d.updateProfile&&d.updateProfile(...r),["prevent"])),class:"settings-form"},[e("div",L,[s[16]||(s[16]=e("label",{for:"username"},"Имя пользователя",-1)),p(e("input",{id:"username","onUpdate:modelValue":s[0]||(s[0]=r=>o.profileForm.username=r),disabled:"",class:"form-control"},null,512),[[c,o.profileForm.username]]),s[17]||(s[17]=e("small",{class:"form-text"},"Имя пользователя нельзя изменить",-1))]),e("div",T,[s[18]||(s[18]=e("label",{for:"bio"},"О себе",-1)),p(e("textarea",{id:"bio","onUpdate:modelValue":s[1]||(s[1]=r=>o.profileForm.bio=r),rows:"3",class:"form-control",placeholder:"Расскажите о своих музыкальных предпочтениях..."},null,512),[[c,o.profileForm.bio]])]),e("div",D,[s[19]||(s[19]=e("label",{for:"location"},"Местоположение",-1)),p(e("input",{id:"location","onUpdate:modelValue":s[2]||(s[2]=r=>o.profileForm.location=r),class:"form-control",placeholder:"Город, страна"},null,512),[[c,o.profileForm.location]])]),e("div",_,[s[20]||(s[20]=e("label",null,"Любимые жанры",-1)),s[21]||(s[21]=e("p",{class:"form-hint"},"Выберите до 5 любимых жанров",-1)),e("div",A,[e("div",U,[(i(!0),l(m,null,w(o.availableGenres,r=>(i(),l("button",{type:"button",key:r,class:g(["genre-tag",{selected:o.profileForm.genres.includes(r),"limit-reached":o.profileForm.genres.length>=5&&!o.profileForm.genres.includes(r)}]),onClick:b=>d.toggleGenre(r),disabled:o.profileForm.genres.length>=5&&!o.profileForm.genres.includes(r)},a(r),11,V))),128))]),e("div",M,"Выбрано: "+a(o.profileForm.genres.length)+" из 5",1)])]),e("div",x,[e("button",{type:"submit",class:"btn btn-primary",disabled:o.profileLoading},a(o.profileLoading?"Сохранение...":"Сохранить изменения"),9,B)]),o.profileError?(i(),l("div",I,a(o.profileError),1)):u("",!0),o.profileSuccess?(i(),l("div",J,"Профиль успешно обновлен!")):u("",!0)],32)])):u("",!0),o.activeTab==="security"?(i(),l("div",N,[s[27]||(s[27]=e("h2",null,"Безопасность",-1)),e("form",{onSubmit:s[7]||(s[7]=f((...r)=>d.changePassword&&d.changePassword(...r),["prevent"])),class:"settings-form"},[e("div",O,[s[23]||(s[23]=e("label",{for:"currentPassword"},"Текущий пароль",-1)),p(e("input",{id:"currentPassword","onUpdate:modelValue":s[4]||(s[4]=r=>o.passwordForm.currentPassword=r),type:"password",class:"form-control",required:""},null,512),[[c,o.passwordForm.currentPassword]])]),e("div",j,[s[24]||(s[24]=e("label",{for:"newPassword"},"Новый пароль",-1)),p(e("input",{id:"newPassword","onUpdate:modelValue":s[5]||(s[5]=r=>o.passwordForm.newPassword=r),type:"password",class:"form-control",required:"",minlength:"6"},null,512),[[c,o.passwordForm.newPassword]]),s[25]||(s[25]=e("small",{class:"form-text"},"Минимум 6 символов",-1))]),e("div",z,[s[26]||(s[26]=e("label",{for:"confirmPassword"},"Подтвердите новый пароль",-1)),p(e("input",{id:"confirmPassword","onUpdate:modelValue":s[6]||(s[6]=r=>o.passwordForm.confirmPassword=r),type:"password",class:"form-control",required:""},null,512),[[c,o.passwordForm.confirmPassword]])]),e("div",q,[e("button",{type:"submit",class:"btn btn-primary",disabled:o.passwordLoading},a(o.passwordLoading?"Смена...":"Сменить пароль"),9,G)]),o.passwordError?(i(),l("div",R,a(o.passwordError),1)):u("",!0),o.passwordSuccess?(i(),l("div",H,"Пароль успешно изменен!")):u("",!0)],32)])):u("",!0),o.activeTab==="account"?(i(),l("div",K,[s[32]||(s[32]=e("h2",null,"Управление аккаунтом",-1)),e("div",Q,[e("div",W,[s[28]||(s[28]=e("h3",null,"Удаление аккаунта",-1)),s[29]||(s[29]=e("p",null,"Это действие нельзя отменить. Все ваши данные будут удалены.",-1)),e("button",{class:"btn btn-danger",onClick:s[8]||(s[8]=r=>o.showDeleteModal=!0)}," Удалить аккаунт ")]),e("div",X,[s[30]||(s[30]=e("h3",null,"Выход из аккаунта",-1)),s[31]||(s[31]=e("p",null,"Завершите текущую сессию на этом устройстве",-1)),e("button",{class:"btn btn-secondary",onClick:s[9]||(s[9]=(...r)=>d.logout&&d.logout(...r))},"Выйти")])])])):u("",!0)])]),o.showDeleteModal?(i(),l("div",{key:0,class:"modal-overlay",onClick:s[15]||(s[15]=r=>o.showDeleteModal=!1)},[e("div",{class:"modal-content",onClick:s[14]||(s[14]=f(()=>{},["stop"]))},[e("div",Y,[s[33]||(s[33]=e("h2",null,"Удаление аккаунта",-1)),e("button",{class:"close-btn",onClick:s[10]||(s[10]=r=>o.showDeleteModal=!1)},"✕")]),e("div",Z,[s[35]||(s[35]=e("p",null," Это действие нельзя отменить. Все ваши посты, плейлисты и другие данные будут удалены. ",-1)),e("form",{onSubmit:s[13]||(s[13]=f((...r)=>d.deleteAccount&&d.deleteAccount(...r),["prevent"])),class:"delete-form"},[e("div",$,[s[34]||(s[34]=e("label",{for:"deletePassword"},"Введите пароль для подтверждения",-1)),p(e("input",{id:"deletePassword","onUpdate:modelValue":s[11]||(s[11]=r=>o.deleteForm.password=r),type:"password",class:"form-control",required:""},null,512),[[c,o.deleteForm.password]])]),e("div",ss,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[12]||(s[12]=r=>o.showDeleteModal=!1)}," Отмена "),e("button",{type:"submit",class:"btn btn-danger",disabled:o.deleteLoading},a(o.deleteLoading?"Удаление...":"Удалить аккаунт"),9,es)]),o.deleteError?(i(),l("div",os,a(o.deleteError),1)):u("",!0)],32)])])])):u("",!0)])}const is=h(y,[["render",rs],["__scopeId","data-v-7c2590f4"]]);export{is as default};
