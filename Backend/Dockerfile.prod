FROM python:3.11-alpine

WORKDIR /app
RUN apk add --no-cache gcc musl-dev linux-headers
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
COPY . .
RUN ls -la static/ || echo "Static folder not found"
RUN adduser -D -u 1001 flaskuser && \
    chown -R flaskuser:flaskuser /app
USER flaskuser
EXPOSE 5000
CMD ["gunicorn", "--bind", "0.0.0.0:5000", "--workers", "4", "--timeout", "120", "app:app"]